#!/bin/sh
# count number of smtp connections to mail server to highlight potential bad actors

old="/var/log/socklog/messages/*.[us]"
cur="/var/log/socklog/messages/current"
cat $old $cur | grep -e 'mox.*"new connection" pkg=smtpserver' | awk -F 'remote=| local' '{ print $2 }' | cut -d ':' -f 1 | sort | uniq -c | sort -r
