#!/usr/bin/bash
# Written for ad hoc use / mail server admin
. /etc/os-release

usage() {
cat <<EOF
checkip ipaddress
- grep log for ipaddress
- perform whois
- check if blocked in iptables
EOF
}

if [ ! $# -eq 0 ]; then
	ip=$1
else
    usage
	exit
fi

case $ID in
    void)
        # current mail server is on void
        sudo grep $ip /var/log/socklog/messages/current /var/log/messages/@*
        whois $ip
        echo "Checking $ip in iptables:"
        if ! iptables -C INPUT -j DROP -s "$ip" >/dev/null 2>&1; then
            echo "$ip not in iptables DROP rule"
        else
            echo "$ip already in iptables with DROP rule"
        fi
        ;;
    chimera)
        whois $ip
        ;;
    opensuse-aeon)
        sudo journalctl -g $ip
        whois $ip
        ;;
    opensuse-microos)
        sudo journalctl -g $ip
        whois $ip
        ;;
    *)
        echo "Unknown distribution: $ID"
        exit 1
        ;;
esac
# vim: ft=bash
