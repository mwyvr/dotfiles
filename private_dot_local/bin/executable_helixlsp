#!/usr/bin/sh
. /etc/os-release

LOCAL=~/.local/bin

case $ID in
chimera)
	doas apk add go nodejs python-pip
	;;
void)
	sudo xbps-install -Su go nodejs python3-pip
	;;
"opensuse-tumbleweed")
	# Likely in distrobox container
	sudo zypper install go nodejs python3-pip
	if [ $CONTAINER_ID == "twbox" ]; then
		sudo ln -svf /usr/bin/helix /usr/bin/hx
		distrobox-export --bin /usr/bin/hx
	fi
	;;
*)
	echo "Unknown Linux distribution, terminating."
	exit 1
	;;
esac

echo "Installing language servers for use in Helix editor"

npm update -g
npm i -g @ansible/ansible-language-server # ansible

# bash / sh
npm i -g bash-language-server
go install mvdan.cc/sh/v3/cmd/shfmt@latest

# go
go install golang.org/x/tools/gopls@latest                             # LSP
go install github.com/go-delve/delve/cmd/dlv@latest                    # Debugger
go install golang.org/x/tools/cmd/goimports@latest                     # Formatter
go install github.com/nametake/golangci-lint-langserver@latest         # Linter
go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.60.3 # Linter

# html, css, json, scss, typescript
npm i -g vscode-langservers-extracted emmet-ls prettier typescript-language-server typescript

# python
pip install -U 'python-lsp-server[all]' --break-system-packages # python
pip install -U python-lsp-ruff --break-system-packages          # plugin to support linter
pip install -U ruff --break-system-packages                     # python linter
pip install -U ruff-lsp --break-system-packages                 # lsp for ruff
pip install -U black --break-system-packages                    # python formatter

# markdown
fetch -o ${LOCAL}/marksman -R https://github.com/artempyanykh/marksman/releases/download/2023-12-09/marksman-linux-x64
chmod +x ${LOCAL}/marksman

# not lsp components; not in chimera cports (yet), mapped to space-l
go install -a github.com/jesseduffield/lazygit@latest
