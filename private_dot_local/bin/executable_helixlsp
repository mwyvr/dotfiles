#!/usr/bin/sh
. /etc/os-release

case $ID in
chimera)
    doas apk add go nodejs python-pip
    ;;
void)
    sudo xbps-install -Su go nodejs python3-pip
    ;;
"opensuse-tumbleweed")
    # Likely in distrobox container
    sudo zypper install go nodejs python3-pip
    if [ $CONTAINER_ID == "twbox" ]; then
        sudo ln -svf /usr/bin/helix /usr/bin/hx
        distrobox-export --bin /usr/bin/hx
    fi
    ;;
*)
    echo "Unknown Linux distribution, terminating."
    exit 1
    ;;
esac

echo "Installing language servers for use in Helix editor"

npm update -g
npm i -g @ansible/ansible-language-server # ansible
npm i -g bash-language-server             # bash
# go
go install -a golang.org/x/tools/gopls@latest          # language server
go install -a github.com/go-delve/delve/cmd/dlv@latest # Debugger
go install -a golang.org/x/tools/cmd/goimports@latest  # Formatter
# html, css, json, scss
npm i -g vscode-langservers-extracted
# python
pip install -U 'python-lsp-server[all]' --break-system-packages # python
pip install -U python-lsp-ruff --break-system-packages          # plugin to support linter
pip install -U ruff --break-system-packages                     # python linter
pip install -U ruff-lsp --break-system-packages                 # lsp for ruff
pip install -U black --break-system-packages                    # python formatter

# not lsp components; not in chimera cports (yet), mapped to space-l
go install -a github.com/jesseduffield/lazygit@latest
