#!/bin/sh
# db - enter, or create and enter, a default DistroBox
# DISTRO="registry.opensuse.org/opensuse/tumbleweed:latest"
NAME="tumbleweed"

# switch to NAME supplied as argument i.e. void
# distrobox will try to match image to NAME if a distrobox needs to be created
if [ -n "$1" ]; then
    NAME="$1"
    DISTRO="$1"
fi

if [ -n "${CONTAINER_ID}" ] && [ "${CONTAINER_ID}" != "${NAME}" ]; then
    echo "In a distrobox; exit and try db command again"
    exit 1
elif [ -n "${CONTAINER_ID}" ] && [ "${CONTAINER_ID}" = "${NAME}" ]; then
    echo "Already in distrobox: $NAME"
    exit
fi

if ! test -x /bin/distrobox-enter; then
    echo "distrobox does not appear to be installed, exiting"
    exit 1
fi

if [ -z "${CONTAINER_ID}" ]; then
    if ! /bin/distrobox-list | grep -q "$NAME"; then
        echo "Creating $NAME distrobox from $DISTRO, please wait"
        /bin/distrobox-create -n "${NAME}" --image "${DISTRO}"
    fi
    exec "/bin/distrobox-enter" -n "${NAME}" "$@"
fi
